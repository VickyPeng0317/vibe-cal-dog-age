<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <link rel="icon" type="image/png" href="./app-icon.png">
  <link rel="apple-touch-icon" href="./app-icon.png">
  <link rel="apple-touch-icon" sizes="180x180" href="./app-icon.png">
  <meta charset="UTF-8" />
  <title>ç‹—ç‹—å¹´é½¡å°å¹«æ‰‹ï½œDog Age Converter</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* ====== å…¨ç«™è¨­å®š ====== */
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans TC",
        "PingFang TC", sans-serif;
      background: #fff7e6;
      color: #4a3b2a;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      padding: 24px 12px;
    }

    .app {
      width: 100%;
      max-width: 480px;
      background: #fffaf0;
      border-radius: 24px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
      padding: 24px 20px 28px;
      position: relative;
      overflow: hidden;
    }

    .ear {
      width: 80px;
      height: 80px;
      background: #e0a15a;
      position: absolute;
      top: -40px;
      border-radius: 80px 80px 10px 10px;
      transform: rotate(-18deg);
      opacity: 0.9;
    }

    .ear.right {
      right: -10px;
      transform: rotate(18deg) scaleX(-1);
    }

    .ear.left {
      left: -10px;
    }

    .header {
      text-align: center;
      margin-bottom: 20px;
      position: relative;
      z-index: 1;
    }

    .title {
      font-size: 1.6rem;
      font-weight: 700;
      margin-bottom: 6px;
      color: #4a3b2a;
    }

    .subtitle {
      font-size: 0.95rem;
      color: #8a6a4a;
    }

    .dog-icon {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      margin: 10px auto 0;
      background: radial-gradient(circle at 30% 30%, #fff, #f5c26b 60%, #c58a3a 100%);
      position: relative;
      overflow: hidden;
      border: 3px solid #f5c26b;
    }

    .dog-face {
      position: absolute;
      inset: 0;
    }

    .dog-eye {
      width: 8px;
      height: 8px;
      background: #4a3b2a;
      border-radius: 50%;
      position: absolute;
      top: 32px;
    }

    .dog-eye.left {
      left: 26px;
    }

    .dog-eye.right {
      right: 26px;
    }

    .dog-nose {
      width: 14px;
      height: 10px;
      background: #4a3b2a;
      border-radius: 50% 50% 60% 60%;
      position: absolute;
      left: 50%;
      top: 42px;
      transform: translateX(-50%);
    }

    .dog-mouth {
      width: 22px;
      height: 14px;
      border-bottom: 3px solid #4a3b2a;
      border-radius: 0 0 40px 40px;
      position: absolute;
      left: 50%;
      top: 48px;
      transform: translateX(-50%);
    }

    .card {
      background: #fffdf7;
      border-radius: 18px;
      padding: 16px 14px;
      margin-bottom: 14px;
      border: 1px solid #f3e0c4;
      position: relative;
      z-index: 1;
    }

    .card-title {
      font-size: 1.05rem;
      font-weight: 600;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
      color: #4a3b2a;
    }

    .chip {
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: #ffe2a8;
      color: #704b1f;
    }

    .form-row {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 12px;
    }

    label {
      font-size: 0.9rem;
      color: #6b5436;
    }

    input[type="date"],
    input[type="text"] {
      width: 100%;
      border-radius: 10px;
      padding: 8px 10px;
      border: 1px solid #e0c59f;
      font-size: 0.95rem;
      background: #fffaf3;
      color: #4a3b2a;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease;
    }

    input[type="date"]:focus,
    input[type="text"]:focus {
      border-color: #e0a15a;
      box-shadow: 0 0 0 2px rgba(224, 161, 90, 0.2);
    }

    .hint {
      font-size: 0.8rem;
      color: #a1825e;
    }

    .error {
      font-size: 0.8rem;
      color: #b4553d;
      margin-top: 4px;
    }

    .result-card {
      background: #fff6e0;
      border-radius: 18px;
      padding: 14px 14px 16px;
      border: 1px solid #f0d3a4;
      position: relative;
      z-index: 1;
    }

    .result-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .paw {
      font-size: 1.1rem;
    }

    .result-main {
      font-size: 1rem;
      line-height: 1.6;
      color: #4a3b2a;
    }

    .result-main strong {
      color: #c2762b;
    }

    .result-sub {
      font-size: 0.85rem;
      color: #8a6a4a;
      margin-top: 6px;
    }

    .placeholder-text {
      font-size: 0.9rem;
      color: #a1825e;
    }

    /* === æ–°å¢ï¼šä¸»æŒ‰éˆ•æ¨£å¼ === */
    .btn-row {
      display: flex;
      justify-content: flex-end;
      margin-top: 4px;
    }

    .primary-btn {
      border: none;
      border-radius: 999px;
      padding: 8px 18px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      background: #e0a15a;
      color: #fffaf3;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.12);
      transition: transform 0.08s ease, box-shadow 0.08s ease,
        background 0.15s ease;
    }

    .primary-btn:hover {
      background: #d18f48;
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.16);
      transform: translateY(-1px);
    }

    .primary-btn:active {
      transform: translateY(0);
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.14);
    }

    @media (max-width: 480px) {
      .app {
        padding: 20px 16px 22px;
        border-radius: 20px;
      }
    }
  </style>
</head>
<body>
  <main class="app">
    <div class="ear left"></div>
    <div class="ear right"></div>

    <header class="header">
      <div class="title">ç‹—ç‹—å¹´é½¡å°å¹«æ‰‹</div>
      <div class="subtitle">è¼¸å…¥æ¯›å­©ç”Ÿæ—¥ï¼Œä¸€èµ·çœ‹çœ‹ç‰ ç¾åœ¨å¹¾æ­²ã€åƒå¹¾æ­²çš„äºº ğŸ¶</div>
      <div class="dog-icon" aria-hidden="true">
        <div class="dog-face">
          <div class="dog-eye left"></div>
          <div class="dog-eye right"></div>
          <div class="dog-nose"></div>
          <div class="dog-mouth"></div>
        </div>
      </div>
    </header>

    <section class="card" aria-label="ç‹—ç‹—è³‡æ–™è¼¸å…¥">
      <div class="card-title">
        å¡«å¯«ç‹—ç‹—è³‡è¨Š
        <span class="chip">Shiba è‰²ç³»</span>
      </div>

      <div class="form-row">
        <label for="dog-name">ç‹—ç‹—åå­—ï¼ˆé¸å¡«ï¼‰</label>
        <input
          id="dog-name"
          type="text"
          placeholder="ä¾‹å¦‚ï¼šå¦™éº—ã€çƒçƒã€Money..."
        />
        <p class="hint">è‹¥æœªå¡«å¯«ï¼Œæœƒä»¥ã€Œç‹—ç‹—ã€ç¨±å‘¼ã€‚</p>
      </div>

      <div class="form-row">
        <label for="birthdate">ç‹—ç‹—å‡ºç”Ÿæ—¥æœŸ <span style="color:#b4553d;">ï¼Šå¿…å¡«</span></label>
        <input id="birthdate" type="date" />
        <p class="hint">è«‹é¸æ“‡ç‹—ç‹—çš„å‡ºç”Ÿå¹´æœˆæ—¥ï¼Œç³»çµ±æœƒè‡ªå‹•å¹«ä½ æ›ç®—å¹´é½¡ã€‚</p>
        <p id="error-msg" class="error" style="display:none;"></p>
      </div>

      <p class="hint">
        æ›ç®—è¦å‰‡ï¼šå‰ 1 å¹´ç´„ç­‰æ–¼äººé¡ 15 æ­²ï¼Œç¬¬ 2 å¹´å†åŠ  9 æ­²ï¼Œä¹‹å¾Œæ¯å¤š 1 å¹´åŠ  5 æ­²ï¼ˆåƒ…ä¾›åƒè€ƒï¼‰ã€‚
      </p>

      <!-- === æ–°å¢ï¼šè¨ˆç®—æŒ‰éˆ•ï¼ˆæŒ‰ä¸‹æ™‚æ‰å„²å­˜ localStorageï¼‰ === -->
      <div class="btn-row">
        <button id="calc-btn" type="button" class="primary-btn">
          <span>ğŸ¶</span>
          <span>é–‹å§‹è¨ˆç®—ä¸¦è¨˜ä½ç”Ÿæ—¥</span>
        </button>
      </div>
    </section>

    <section class="result-card" aria-label="æ›ç®—çµæœ">
      <div class="result-title">
        <span class="paw">ğŸ¾</span>
        æ›ç®—çµæœ
      </div>
      <div id="result-area">
        <p class="placeholder-text">
          è«‹å…ˆè¼¸å…¥ç‹—ç‹—çš„å‡ºç”Ÿæ—¥æœŸï¼ŒæŒ‰ä¸‹ã€Œé–‹å§‹è¨ˆç®—ã€å¾Œï¼Œé€™è£¡æœƒé¡¯ç¤ºç‰ ç¾åœ¨å¹¾æ­²ï¼Œä»¥åŠå¤§ç´„ç›¸ç•¶æ–¼å¹¾æ­²çš„äººé¡ã€‚
        </p>
      </div>
    </section>
  </main>

  <script>
    const birthInput = document.getElementById("birthdate");
    const nameInput = document.getElementById("dog-name");
    const errorMsg = document.getElementById("error-msg");
    const resultArea = document.getElementById("result-area");
    const calcBtn = document.getElementById("calc-btn");

    const STORAGE_KEY_BIRTH = "dogAgeHelper_birthdate";

    // è¨­å®š max ç‚ºä»Šå¤©ï¼Œé¿å…æœªä¾†æ—¥æœŸ
    (function initDateLimit() {
      const today = new Date();
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth() + 1).padStart(2, "0");
      const dd = String(today.getDate()).padStart(2, "0");
      birthInput.max = `${yyyy}-${mm}-${dd}`;
    })();

    // === æ–°å¢ï¼šå¾ localStorage æŠŠç”Ÿæ—¥å¸¶å›ä¾† ===
    (function restoreFromLocalStorage() {
      try {
        const savedBirth = localStorage.getItem(STORAGE_KEY_BIRTH);
        if (savedBirth) {
          birthInput.value = savedBirth;
          // è‡ªå‹•å¹«ä½¿ç”¨è€…ç®—å¥½ä¸€æ¬¡
          calculateDogAge();
        }
      } catch (e) {
        // è‹¥ç€è¦½å™¨ç„¡æ³•ä½¿ç”¨ localStorageï¼Œå°±å®‰éœå¿½ç•¥
        console.warn("localStorage not available", e);
      }
    })();

    function calculateDogAge() {
      const birthValue = birthInput.value;
      const dogNameRaw = nameInput.value.trim();
      const dogName = dogNameRaw || "ç‹—ç‹—";

      errorMsg.style.display = "none";
      errorMsg.textContent = "";

      if (!birthValue) {
        resultArea.innerHTML =
          '<p class="placeholder-text">è«‹å…ˆé¸æ“‡å‡ºç”Ÿæ—¥æœŸï¼Œç³»çµ±æœƒè‡ªå‹•é¡¯ç¤ºå¹´é½¡çµæœã€‚</p>';
        return;
      }

      const birthDate = new Date(birthValue);
      const today = new Date();

      if (birthDate > today) {
        errorMsg.style.display = "block";
        errorMsg.textContent = "å‡ºç”Ÿæ—¥æœŸä¸èƒ½æ™šæ–¼ä»Šå¤©å”·ï¼";
        resultArea.innerHTML =
          '<p class="placeholder-text">è«‹é‡æ–°ç¢ºèªå‡ºç”Ÿå¹´æœˆæ—¥ã€‚</p>';
        return;
      }

      let years = today.getFullYear() - birthDate.getFullYear();
      let months = today.getMonth() - birthDate.getMonth();
      let days = today.getDate() - birthDate.getDate();

      if (days < 0) {
        months -= 1;
      }

      if (months < 0) {
        years -= 1;
        months += 12;
      }

      const ageInYearsFloat = years + months / 12;
      let humanAge;
      if (ageInYearsFloat <= 0) {
        humanAge = 0;
      } else if (ageInYearsFloat <= 1) {
        humanAge = 15 * ageInYearsFloat;
      } else if (ageInYearsFloat <= 2) {
        humanAge = 15 + 9 * (ageInYearsFloat - 1);
      } else {
        humanAge = 24 + 5 * (ageInYearsFloat - 2);
      }

      const humanAgeRounded = humanAge.toFixed(1);

      let ageText = "";
      if (years <= 0 && months <= 0) {
        ageText = "é‚„ä¸åˆ° 1 å€‹æœˆçš„å°å¯¶å¯¶ ğŸ¼";
      } else if (years <= 0) {
        ageText = `${months} å€‹æœˆå¤§`;
      } else if (months === 0) {
        ageText = `${years} æ­²`;
      } else {
        ageText = `${years} æ­² ${months} å€‹æœˆ`;
      }

      resultArea.innerHTML = `
        <p class="result-main">
          <strong>${dogName}</strong> ç¾åœ¨å¤§ç´„æ˜¯ <strong>${ageText}</strong>ã€‚<br />
          è‹¥æ›ç®—æˆäººé¡å¹´é½¡ï¼Œå¤§ç´„ç›¸ç•¶æ–¼ <strong>${humanAgeRounded} æ­²</strong>ã€‚
        </p>
        <p class="result-sub">
          ï¼Šæ­¤ç‚ºæ¦‚ç•¥æ›ç®—ï¼Œä¸åŒçŠ¬ç¨®èˆ‡é«”å‹å¯¦éš›è€åŒ–é€Ÿåº¦æœƒç•¥æœ‰å·®ç•°ï¼Œè«‹æ­é…ç¸é†«å¸«å»ºè­°ä¸€èµ·è©•ä¼°ã€‚
        </p>
      `;
    }

    // === æ–°å¢ï¼šæŒ‰ä¸‹æŒ‰éˆ•æ‰å„²å­˜ç”Ÿæ—¥åˆ° localStorage ===
    calcBtn.addEventListener("click", () => {
      calculateDogAge();
      const birthValue = birthInput.value;
      if (!birthValue) return;

      try {
        localStorage.setItem(STORAGE_KEY_BIRTH, birthValue);
      } catch (e) {
        console.warn("cannot save to localStorage", e);
      }
    });

    // åå­—è®Šæ›´æ™‚å³æ™‚æ›´æ–°ç•«é¢ï¼ˆä¸å½±éŸ¿å„²å­˜é‚è¼¯ï¼‰
    nameInput.addEventListener("input", () => {
      if (birthInput.value) {
        calculateDogAge();
      }
    });
  </script>
</body>
</html>
